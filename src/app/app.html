<div class="dashboard-layout">

  <!-- ============================================ -->
  <!-- üéØ OVERLAY PARA MOBILE (Fondo oscuro) -->
  <!-- ============================================ -->
  <div class="sidebar-overlay" [class.active]="isSidebarOpen() && isMobile()" (click)="closeSidebar()">
  </div>

  <!-- ============================================ -->
  <!-- üì± SIDEBAR (Men√∫ Lateral) -->
  <!-- ============================================ -->
  <aside class="sidebar" [class.sidebar-open]="isSidebarOpen()"
    [class.sidebar-collapsed]="isSidebarCollapsed() && !isMobile()">

    <!-- Header del Sidebar -->
    <div class="sidebar-header">
      <a routerLink="/home" class="logo">
        <i class="icon-leaf logo-icon"></i>
        <span class="logo-text">Vision Lab</span>
      </a>

      <!-- Bot√≥n para colapsar (solo desktop) -->
      <button class="sidebar-toggle" (click)="toggleSidebar()" *ngIf="!isMobile()" title="Colapsar men√∫">
        ‚óÄ
      </button>
    </div>

    <!-- Navegaci√≥n -->
    <nav class="sidebar-nav">

      <!-- Secci√≥n: App Modules -->
      <h3 class="nav-heading">App Modules</h3>
      <ul class="nav-list">
        <li>
          <a routerLink="/camera" routerLinkActive="active" (click)="onNavLinkClick()">
            <i class="icon-camera"></i>
            <span>Camera (Capture)</span>
          </a>
        </li>

        <!-- <li>
          <a routerLink="/chat" routerLinkActive="active" (click)="onNavLinkClick()">
            <i class="icon-chat"></i>
            <span>Chat Assistant</span>
            <span class="badge badge-info">3</span>
          </a>
        </li> -->

        <li>
          <a routerLink="/almanac" routerLinkActive="active" (click)="onNavLinkClick()">
            <i class="icon-almanac"></i>
            <span>Almanac (Species)</span>
          </a>
        </li>
      </ul>

      <!-- L√≠nea divisoria -->
      <div class="nav-divider"></div>

      <!-- Secci√≥n: User & Utility -->
      <h3 class="nav-heading">User & Utility</h3>
      <ul class="nav-list">
        <li>
          <a class="has-submenu">
            <i class="icon-trophy"></i>
            <span>Gamification</span>
            <i class="icon-chevron-right submenu-indicator"></i>
          </a>
        </li>

        <li>
          <a routerLink="/settings" routerLinkActive="active" (click)="onNavLinkClick()">
            <i class="icon-settings"></i>
            <span>Settings</span>
          </a>
        </li>

        <li>
          <a routerLink="/legal" routerLinkActive="active" (click)="onNavLinkClick()">
            <i class="icon-legal"></i>
            <span>Legal & Privacy</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- ============================================ -->
  <!-- üìÑ CONTENEDOR PRINCIPAL -->
  <!-- ============================================ -->
  <div class="main-content-wrapper">

    <!-- ============================================ -->
    <!-- üìå TOPBAR (Barra Superior) -->
    <!-- ============================================ -->
    <header class="topbar">

      <!-- Lado Izquierdo -->
      <div class="topbar-left">
        <!-- Bot√≥n Hamburguesa (Mobile: abre sidebar / Desktop: colapsa) -->
        <button class="menu-toggle" (click)="toggleSidebar()" [title]="isMobile() ? 'Abrir men√∫' : 'Colapsar men√∫'">
          <i class="icon-bars"></i>
        </button>

        <!-- Links de Login/Register (solo si NO est√° logueado) -->
        @if (!isLoggedIn()) {
        <a routerLink="/login" class="topbar-icon">
          <i class="icon-user"></i>
          <span>Login</span>
        </a>
        <a routerLink="/register" class="topbar-icon">
          <i class="icon-register"></i>
          <span>Register</span>
        </a>
        }
      </div>

      <!-- Lado Derecho -->
      <div class="topbar-right">

        <!-- Men√∫ de Perfil (solo si est√° logueado) -->
        @if (isLoggedIn()) {
        <div class="profile-menu-container" [class.active]="isProfileMenuOpen()">

          <!-- Trigger del men√∫ -->
          <div class="profile-trigger" (click)="toggleProfileMenu()">
            <i class="icon-user-circle profile-icon"></i>
            <span class="profile-name">{{ currentUser().name }}</span>
            <i class="icon-arrow-down dropdown-arrow"></i>
          </div>

          <!-- Men√∫ Desplegable -->
          <div class="profile-dropdown" [class.active]="isProfileMenuOpen()" (click)="$event.stopPropagation()">

            <!-- Header del dropdown -->
            <div class="dropdown-header">
              <div class="user-name">{{ currentUser().name }}</div>
              <div class="user-email">{{ currentUser().email }}</div>
            </div>

            <!-- Opciones del men√∫ -->
            <div class="dropdown-menu">
              <a (click)="goToDashboard()">
                <i class="icon-dashboard"></i>
                <span>Dashboard</span>
              </a>

              <a (click)="goToProfile()">
                <i class="icon-profile"></i>
                <span>Mi Perfil</span>
              </a>

              <a routerLink="/settings" (click)="isProfileMenuOpen.set(false)">
                <i class="icon-settings"></i>
                <span>Configuraci√≥n</span>
              </a>

              <div class="dropdown-divider"></div>

              <a class="dropdown-logout" (click)="logout()">
                <i class="icon-logout"></i>
                <span>Cerrar Sesi√≥n</span>
              </a>
            </div>
          </div>
        </div>
        }

        <!-- Botones de Login/Register para Mobile (si NO est√° logueado) -->
        @if (!isLoggedIn() && isMobile()) {
        <a routerLink="/login" class="topbar-icon">
          <i class="icon-user"></i>
        </a>
        <a routerLink="/register" class="topbar-icon">
          <i class="icon-register"></i>
        </a>
        }
      </div>
    </header>

    <!-- ============================================ -->
    <!-- üìÑ CONTENIDO PRINCIPAL -->
    <!-- ============================================ -->
    <main class="main-content">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>